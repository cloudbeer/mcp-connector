# MCP 服务端集合工具实现计划

## 第一阶段：基础架构搭建

### 1.1 项目初始化
- [x] 创建项目目录结构
- [x] 设置 Python 虚拟环境（使用 uv）
- [x] 创建 pyproject.toml
- [x] 设置 .env.example 文件
- [x] 初始化 Git 仓库

### 1.2 数据库设计和初始化
- [x] 设计数据库 Schema
- [x] 创建数据库迁移脚本
- [x] 实现自定义数据库封装类
- [x] 配置 pgvector 扩展

### 1.3 基础 FastAPI 应用
- [x] 创建 FastAPI 应用结构
- [x] 实现配置管理
- [x] 添加健康检查端点
- [x] 设置异步支持

## 第二阶段：MCP 工具管理

### 2.1 MCP 工具配置管理
- [ ] 实现 MCP 工具的 CRUD 操作
- [ ] 实现服务器分组功能
- [ ] 创建工具状态管理
- [ ] 实现工具启动/停止逻辑

### 2.2 Strands Agent 集成
- [ ] 集成 Strands Agents SDK
- [ ] 实现 MCP 客户端管理
- [ ] 处理多种连接方式（stdio、HTTP、SSE）
- [ ] 实现工具健康检查和重试机制

## 第三阶段：助手系统

### 3.1 助手配置管理
- [ ] 实现助手的 CRUD 操作
- [ ] 实现助手与工具的关联关系
- [ ] 支持专用助手配置

### 3.2 通用全域助手
- [ ] 实现意图识别（LLM）
- [ ] 实现工具向量化
- [ ] 实现向量检索和 Rerank
- [ ] 动态工具召回逻辑

## 第四阶段：多平台 API 兼容

### 4.1 API 路由实现
- [ ] OpenAI API 兼容接口
- [ ] Gemini API 兼容接口
- [ ] Bedrock API 兼容接口
- [ ] Anthropic API 兼容接口

### 4.2 格式转换和流式响应
- [ ] 实现请求格式转换
- [ ] 实现响应格式转换
- [ ] 支持 SSE 流式响应
- [ ] 错误处理和异常转换

## 第五阶段：测试和优化

### 5.1 单元测试
- [ ] 数据库操作测试
- [ ] MCP 工具管理测试
- [ ] 助手系统测试
- [ ] API 接口测试

### 5.2 集成测试
- [ ] 端到端测试
- [ ] 多平台 API 兼容性测试
- [ ] 性能测试

## 开发优先级

**高优先级（MVP）**：
1. 基础架构搭建
2. MCP 工具管理
3. 简单的专用助手
4. OpenAI API 兼容

**中优先级**：
1. 通用全域助手
2. 其他平台 API 兼容
3. 流式响应

**低优先级**：
1. 高级 Rerank 策略
2. 性能优化
3. 完整测试覆盖

## 技术难点预估

1. **Strands Agent 动态配置**：需要研究是否支持运行时修改工具配置
2. **向量检索性能**：大量工具时的检索效率
3. **多平台 API 差异**：不同平台的细微差别处理
4. **异步协调**：MCP 工具异步调用与流式响应的协调
